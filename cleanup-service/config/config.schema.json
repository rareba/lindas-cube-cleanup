{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LINDAS Cube Cleanup Service Configuration",
  "type": "object",
  "required": ["triplestore", "cleanup", "backup"],
  "properties": {
    "triplestore": {
      "type": "object",
      "required": ["type", "queryEndpoint", "updateEndpoint"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["fuseki", "stardog", "graphdb"],
          "description": "Type of triplestore"
        },
        "queryEndpoint": {
          "type": "string",
          "format": "uri",
          "description": "SPARQL query endpoint URL"
        },
        "updateEndpoint": {
          "type": "string",
          "format": "uri",
          "description": "SPARQL update endpoint URL"
        },
        "graphStoreEndpoint": {
          "type": "string",
          "format": "uri",
          "description": "Graph Store Protocol endpoint for bulk operations"
        },
        "authentication": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["none", "basic", "bearer"],
              "default": "none"
            },
            "username": { "type": "string" },
            "password": { "type": "string" },
            "token": { "type": "string" }
          }
        }
      }
    },
    "cleanup": {
      "type": "object",
      "required": ["graphs", "versionsToKeep"],
      "properties": {
        "graphs": {
          "type": "array",
          "items": { "type": "string", "format": "uri" },
          "minItems": 1,
          "description": "Named graphs to clean up"
        },
        "versionsToKeep": {
          "type": "integer",
          "minimum": 1,
          "default": 2,
          "description": "Number of newest versions to keep per cube"
        },
        "chunkSize": {
          "type": "integer",
          "minimum": 1000,
          "default": 50000,
          "description": "Number of triples to delete per batch"
        },
        "dryRun": {
          "type": "boolean",
          "default": false,
          "description": "Preview changes without executing deletions"
        }
      }
    },
    "backup": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "type": {
          "type": "string",
          "enum": ["local", "s3", "azure"],
          "description": "Backup storage type"
        },
        "retentionDays": {
          "type": "integer",
          "minimum": 1,
          "default": 90,
          "description": "Days to keep backups before automatic deletion"
        },
        "local": {
          "type": "object",
          "properties": {
            "path": { "type": "string" }
          }
        },
        "s3": {
          "type": "object",
          "properties": {
            "bucket": { "type": "string" },
            "region": { "type": "string" },
            "prefix": { "type": "string" },
            "accessKeyId": { "type": "string" },
            "secretAccessKey": { "type": "string" },
            "endpoint": { "type": "string", "description": "Custom S3 endpoint for MinIO, etc." }
          }
        }
      }
    },
    "logging": {
      "type": "object",
      "properties": {
        "level": {
          "type": "string",
          "enum": ["error", "warn", "info", "debug"],
          "default": "info"
        },
        "file": { "type": "string" },
        "console": { "type": "boolean", "default": true }
      }
    }
  }
}
